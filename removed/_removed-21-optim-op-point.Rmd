# Optimal operating point on FROC {#optim-op-point}

---
output:
  rmarkdown::pdf_document:
    fig_caption: yes        
    includes:  
      in_header: R/learn/my_header.tex
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval.after = "fig.cap"
)

library(RJafroc)
library(ggplot2)
library(kableExtra)
library(gridExtra)
library(abind)
library(dplyr)
```



```{r, echo=FALSE}
OpPtStr <- function(x,y) {
  y <- paste0("(", sprintf("%.3f", x), ", ", sprintf("%.3f", y), ")")
  return(y)
}
```



## How much finished {#optim-op-point-how-much-finished}
70%


## Dependence of ROC performance on threshold {#optim-op-point-dependence-threshold-roc}
binormal-model-partial-true

When $\zeta_1 = -\infty$ then performance, represented by the area $\text{AUC}$ under the full continuous curve shown below (left plot), is indeed independent of reporting threshold (trivially, because the latter is constant at $-\infty$). However, if the observer adopts a finite reporting threshold $\zeta_1$ then the ROC curve stops at an operating point, see Fig. \@ref(fig:optim-op-point-dependence-threshold-roc-plot1) -- solid dot, left plot -- that is below-left of (1,1). *Net performance, represented by the area under the continuous section up to the solid dot plus the area under the dashed line in the left plot*, is denoted $\text{AUC}(\zeta_1)$, which depends on $\zeta_1$. It is clear from the left plot that $\text{AUC}(\zeta_1) \le \text{AUC}$. The left plot also demonstrates that $\text{AUC}(\zeta_1)$ as a function of $\zeta_1$ has a maximum at $\zeta_1 = -\infty$. In other words, using the ROC figure of merit, performance of the CAD algorithm is maximized by displaying *all* the marks. 

The restriction above to the left plot is because it is (almost) a proper ROC curve ^[whenever $b \ne 1$ the binormal ROC curve is improper, although the "hook" may not be readily visible under normal plotting conditions.]. For a proper ROC curve the slope decreases continuously as one moves up the plot. This ensures that the continuous section to the right of the solid dot in the left plot is always *above* the dashed line. The right plot in see Fig. \@ref(fig:optim-op-point-dependence-threshold-roc-plot1) corresponding to $a = 1$ and $b = 0.2$, illustrates the situation when the curve is visibly improper. Now the dashed line is mostly above the continuous section and performance is maximized at a finite value of $\zeta_1$: an invalid conclusion due to the fact that an improper ROC curve is a fitting artifact of the binormal model.  

```{r echo=FALSE}
a <- 2; b <- 0.8; zeta1Arr <- seq(1.5,5.5,0.05)
zeta1ArrAll <- seq(-3,5.5,0.05)
FPF <- pnorm(-zeta1Arr)
TPF <- pnorm(a - b*zeta1Arr)
#truncated <- data.frame(FPF = FPF, TPF = TPF)
continuous <- data.frame(FPF = pnorm(-zeta1ArrAll), TPF = pnorm(a - b*zeta1ArrAll))
dashed <- data.frame(FPF = c(FPF[1], 1), TPF = c(TPF[1], 1))
endPoint <- data.frame(x = FPF[1], y = TPF[1])
p1 <- ggplot2::ggplot(continuous, aes(x = FPF, y = TPF)) + 
  geom_line() + 
  geom_line(data = dashed, aes(x = FPF, y = TPF), linetype = 3) + 
  geom_point(data = endPoint, aes(x = x, y = y), size = 4) + 
  scale_x_continuous(limits = c(0,1)) + scale_y_continuous(limits = c(0,1))
```



```{r echo=FALSE}
a <- 1; b <- 0.2; zeta1Arr <- seq(1.5,5.5,0.05)
zeta1ArrAll <- seq(-10,15,0.05)
FPF <- pnorm(-zeta1Arr)
TPF <- pnorm(a - b*zeta1Arr)
#truncated <- data.frame(FPF = FPF, TPF = TPF)
continuous <- data.frame(FPF = pnorm(-zeta1ArrAll), TPF = pnorm(a - b*zeta1ArrAll))
dashed <- data.frame(FPF = c(FPF[1], 1), TPF = c(TPF[1], 1))
endPoint <- data.frame(x = FPF[1], y = TPF[1])
p2 <- ggplot2::ggplot(continuous, aes(x = FPF, y = TPF)) + 
  geom_line() + 
  geom_line(data = dashed, aes(x = FPF, y = TPF), linetype = 3) + 
  geom_point(data = endPoint, aes(x = x, y = y), size = 4) + 
  scale_x_continuous(limits = c(0,1)) + scale_y_continuous(limits = c(0,1))
```



```{r optim-op-point-dependence-threshold-roc-plot1, fig.cap="Left plot: almost proper binormal ROC curve corresponding to a = 2 and b = 0.8. The solid dot is the operating point corresponding to $\\zeta_1 = 1.5$. The solid curve corresponds to $\\zeta_1 = -\\infty$. Note that the solid curve is above the dashed line. Right plot: improper binormal ROC curve corresponding to a = 1 and b = 0.2. The solid curve is below the dashed line.", fig.show='hold', echo=FALSE}
grid.arrange(p1, p2, ncol = 2)
```


