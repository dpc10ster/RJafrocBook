[
["index.html", "RJafroc documentation Chapter 1 Preface", " RJafroc documentation Dev P. Chakraborty 2019-08-05 Chapter 1 Preface This book, an extended documentation of the RJafroc package, is undergoing extensive edits. It should not be used by the casual user until I give the go ahead. It bypasses the file size limits of CRAN, currently 5 MB, which severely limits the extent of the documentation that can be included with the CRAN version of the package. I welcome corrections and comments by the not-so-casual-user. Please use the GitHub website to raise issues and comments+ https://github.com/dpc10ster/RJafrocBook "],
["intro.html", "Chapter 2 Introduction", " Chapter 2 Introduction This is the book desribing the RJafroc packages. The name of the book is RJafrocBook Modality and treatment are used interchangeably. Reader is a generic radiologist, or a computer aided detection algorithm, or any algorithmic “reader” TBA "],
["rocdataformat.html", "Chapter 3 ROC data format 3.1 Introduction 3.2 An actual MRMC ROC dataset 3.3 The ROC Excel data file", " Chapter 3 ROC data format 3.1 Introduction In the receiver operating characteristic (ROC) paradigm (Metz 1978) the observer’s task is to rate (i.e., assign an ordered label representing the degree of suspicion) each case for confidence in presence of disease. The rating is frequently called a confidence level. The rating can be an integer or quasi- continuous (e.g., 0 – 100), or a floating point value, as long as higher numbers represent greater confidence in presence of one or more lesions in the case.1 For human observer studies a 6-point rating scale is recommended, collected via two questions (Chakraborty 2017): Is the case diseased? Binary response: Yes or No. What is your confidence in the preceding decisions? Three level response: Low, Medium or High. With algorithmic readers, e.g., computer aided detection algorithms a floating point rating, if possible, should be retained. In the most common study design, termed multiple-reader multiple-case (MRMC) the rating collection procedure is repeated for all cases, treatments and readers. 3.2 An actual MRMC ROC dataset An actual MRMC ROC dataset (Van Dyke et al. 1993) is included as dataset02. It has the following structure: str(dataset02) #&gt; List of 8 #&gt; $ NL : num [1:2, 1:5, 1:114, 1] 1 3 2 3 2 2 1 2 3 2 ... #&gt; $ LL : num [1:2, 1:5, 1:45, 1] 5 5 5 5 5 5 5 5 5 5 ... #&gt; $ lesionNum : int [1:45] 1 1 1 1 1 1 1 1 1 1 ... #&gt; $ lesionID : num [1:45, 1] 1 1 1 1 1 1 1 1 1 1 ... #&gt; $ lesionWeight: num [1:45, 1] 1 1 1 1 1 1 1 1 1 1 ... #&gt; $ dataType : chr &quot;ROC&quot; #&gt; $ modalityID : Named chr [1:2] &quot;0&quot; &quot;1&quot; #&gt; ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;0&quot; &quot;1&quot; #&gt; $ readerID : Named chr [1:5] &quot;0&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; ... #&gt; ..- attr(*, &quot;names&quot;)= chr [1:5] &quot;0&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; ... 3.2.1 Overview of the data structure The dataset structure is a list variable with 8 members.2 Ratings of non-diseased cases are stored in the NL list member. Ratings of diseased cases are stored in the LL list member. The lesionNum list member is an array of length 45, filled with ones. It lists the number of lesions per case, which for ROC data, is always unity. The length of this array equals the number of diseased cases K2, see below. The lesionID list member is a [45 x 1] array, also filled with ones.3 The LesionWeight list member is also a [45 x 1] array filled with ones. The dataType list member equals the string &quot;ROC&quot;, identifying it as an ROC dataset. The modalityID list member is a string array identifying the names of the treatments (see below). The readerID list member is a string array, identifying the names of the readers (see below). 3.2.2 Details of the modalityID and readerID list members The names of the treatments are in the modalityID list member: attributes(dataset02$modalityID) #&gt; $names #&gt; [1] &quot;0&quot; &quot;1&quot; For example, the name of the first treatment is &quot;0&quot;. The names can be longer strings, but use of very long string names may mess up the output formats of the analysis report. As per the KISS principle,4 keep the names short. The names of the readers are in the readerID array: attributes(dataset02$readerID) #&gt; $names #&gt; [1] &quot;0&quot; &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; For example, the name of the second reader is &quot;1&quot;. A similar caveat regarding long reader names applies. 3.2.3 Details of the NL and LL list members For either NL or LL list members, the fourth dimension has unit length. This dimension, which is strictly speaking unnecessary for ROC data, is retained for ease of generalizability to the FROC and ROC paradigms, where more than one rating per case is possible. dataset02 is a 2-treatment 5-reader dataset (the lengths of the first and second dimensions, respectively, of the NL and LL list members). 3.2.3.1 Numbers of non-diseased and diseased cases K &lt;- length(dataset02$NL[1,1,,1]) K2 &lt;- length(dataset02$LL[1,1,,1]) K1 &lt;- K - K2 K1 is the number of non-diseased cases, while K2 is the number of diseased cases. The third dimension of the NL array is the total number of all cases, i.e., K = 114, and the third dimension of the LL array, i.e., K2 = 45, is the total number of diseased cases. Subtracting the number of diseased cases from the number of all cases yields the number of non-diseased cases. Therefore, in this dataset, there are 45 diseased cases and 69 non-diseased cases. 3.2.3.2 Why dimension the NL array for the total number of cases? Again, this is for ease of generalizability to the FROC and ROI paradigms. 3.2.3.3 Ratings on a non-diseased case For ROC data a non-diseased case can have only one, and exactly one, NL rating. For treatment 1, reader 1 and case 1 (the first non-diseased case), the NL rating is &quot;1&quot;: dataset02$NL[1,1,1,1] #&gt; [1] 1 mean(dataset02$NL[,,1:K1,1]) #&gt; [1] 1.784058 This study utilized a 5-point rating scale, 1 thru 5, so non-diseased cases are expected to have low ratings; in this case the lowest rating was observed. The mean rating over all non-diseased cases, treatments and readers, is 1.784058. 3.2.3.4 Ratings on a diseased case For ROC data a diseased case can have only one, and exactly one, LL rating. For treatment 1, reader 1, case 1 (the first diseased case) the LL rating is: dataset02$LL[1,1,1,1] #&gt; [1] 5 mean(dataset02$LL) #&gt; [1] 4.297778 As noted previously, this study utilized a 5-point rating scale, 1 thru 5, so diseased cases are expected to have high ratings; in this case the highest rating was observed. The mean rating over all diseased cases, treatments and readers, is 4.2977778. 3.3 The ROC Excel data file An Excel file in JAFROC format containing ROC data corresponding to dataset02, is included with the distribution. The first command (below) finds the location of the file and the second command reads it and saves it to a dataset object ds. fileName &lt;- system.file( &quot;extdata&quot;, &quot;includedRocData.xlsx&quot;, package = &quot;RJafroc&quot;, mustWork = TRUE) ds &lt;- DfReadDataFile(fileName) It contains three worksheets, Truth, TP and FP. The Truth worksheet defines the ground-truth of each case. It indicates which cases are diseased and which are non-diseased. The CaseID column lists the numeric labels identifying each case. Again, string names are possible, but keep them short. A 1 in the LesionID column denotes a diseased case. A 0 in the LesionID column denotes a non-diseased case. The Weight column is irrelevant for ROC data.5 The contents of the Truth worksheet corresponding to dataset02 are displayed next: + There are 69 non-diseased cases (labeled 1-69) under column `CaseID`. + There are 45 diseased cases (labeled 70-114). + The `LesionID` field for each non-diseased case (e.g., `CaseID` = 1) is zero. + The `LesionID` field for each diseased case (e.g., `CaseID` = 70) is unity. + The `Weights` field is irrelevant for ROC datasets. For convenience it is filled with zeroes. The FP (or NL) worksheet - this lists the ratings of ROI-level-non-diseased regions. For ReaderID = 1, ModalityID = 1 and CaseID = 1 there are 4 rows, corresponding to the 4 ROI-level-non-diseased regions in this case. The corresponding ratings are 1. The pattern repeats for other treatments and readers, but the rating are, of course, different. Each CaseID is represented in the FP worksheet (a rare exception could occur if a case-level abnon-diseased case has 4 abnon-diseased regions). The TP (or LL) worksheet - this lists the ratings of ROI-level-abnon-diseased regions. Because non-diseased cases generate TPs, one does not find any entry with CaseID = 1-50 in the TP worksheet. The lowest CaseID in the TP worksheet is 51, which corresponds to the first abnon-diseased case. There are two entries for this case, corresponding to the two ROI-level-abnon-diseased regions present in this case. Recall that corresponding to this CaseID in the Truth worksheet there were two entries with LesionID = 2 and 3. These must match the LesionID’s listed for this case in the TP worksheet. Complementing these two entries, in the FP worksheet for CaseID = 51, there are 2 entries corresponding to the two ROI-level-non-diseased regions in this case. One should be satisfied that for each abnon-diseased case the sum of the number of entries in the TP and FP worksheets is always 4. References "],
["frocdataformat.html", "Chapter 4 FROC data format 4.1 Introduction 4.2 An actual FROC dataset 4.3 The FROC Excel data file", " Chapter 4 FROC data format 4.1 Introduction In the free-response ROC (FROC) paradigm (Bunch et al. 1978) the observer’s task is to indicate (i.e., mark the location of) and rate (i.e., assign an ordered label - or confidence level - representing the degree of suspicion) regions in the image that are perceived as suspicious for presence of disease. Accordingly, FROC data consists of mark-rating pairs, where each mark indicates a region6 that was considered suspicious for presence of a localized lesion and the rating is the corresponding confidence level. The number of mark-rating pairs on any particular case is a-priori unpredictable. It is a non-negative random integer (i.e., 0, 1, 2, …) that depends on the case, the reader and the modality. The relatively unstructured nature of FROC data makes FROC paradigm data more difficult to analyze than ROC paradigm data.7 By adopting a proximity criterion, each mark is classified by the investigator as a lesion localization (LL) - if it is close to a real lesion - or a non-lesion localization (NL) otherwise. The rating can be an integer or quasi- continuous (e.g., 0 – 100), or a floating point value, as long as higher numbers represent greater confidence in presence of one or more lesions in the ROI.8 Region-level-normal ratings are stored in the NL field and region-level-abnormal ratings are stored in the LL field. 4.2 An actual FROC dataset An actual FROC dataset (Zanca et al. 2009) is included as dataset04, which has the following dataset structure: str(dataset04) #&gt; List of 8 #&gt; $ NL : num [1:5, 1:4, 1:200, 1:7] -Inf -Inf 1 -Inf -Inf ... #&gt; $ LL : num [1:5, 1:4, 1:100, 1:3] 4 5 4 5 4 3 5 4 4 3 ... #&gt; $ lesionNum : int [1:100] 1 1 1 1 1 1 1 1 1 1 ... #&gt; $ lesionID : num [1:100, 1:3] 1 1 1 1 1 1 1 1 1 1 ... #&gt; $ lesionWeight: num [1:100, 1:3] 1 1 1 1 1 1 1 1 1 1 ... #&gt; $ dataType : chr &quot;FROC&quot; #&gt; $ modalityID : Named chr [1:5] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ... #&gt; ..- attr(*, &quot;names&quot;)= chr [1:5] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ... #&gt; $ readerID : Named chr [1:4] &quot;1&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; #&gt; ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;1&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; Examination of the output reveals that: The dataset structure is a list with 8 members. This is a 5-treatment 4-reader dataset (the lengths of the first and second dimensions, respectively, of the NL and LL arrays). The names of the treatments are in the modalityID array: attributes(dataset04$modalityID) #&gt; $names #&gt; [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; For example, the name of the second treatment is &quot;2&quot;. The names of the readers are in the readerID array: attributes(dataset04$readerID) #&gt; $names #&gt; [1] &quot;1&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; For example, the name of the second reader is &quot;3&quot;. Apparently reader &quot;2&quot; “dropped out” of the study. 4.2.1 Numbers of non-diseased and diseased cases length(dataset04$NL[1,1,,1]) #&gt; [1] 200 length(dataset04$LL[1,1,,1]) #&gt; [1] 100 The third dimension of the NL array is the total number of all cases, i.e., 200, and the third dimension of the LL array, i.e., 100, is the total number of diseased cases. Subtracting the number of diseased cases from the number of all cases yields the number of non-diseased cases. Therefore, in this dataset, there are 100 diseased cases and 100 non-diseased cases. 4.2.2 Why dimension the NL array for the total number of cases? Because, in addition to LLs, NLs are possible on diseased cases. Only LLs are possible on diseased cases. Only NLs are possible on non-diseased cases. The missing values are filled in with -Inf. 4.2.3 Ratings on a non-diseased case For treatment 1, reader 1 and case 1 (the first non-diseased case), the NL ratings are: dataset04$NL[1,1,1,] #&gt; [1] -Inf -Inf -Inf -Inf -Inf -Inf -Inf 4.2.4 The meaning of a negative infinity rating Obviously, a real rating cannot be negative infinity.9 This value is reserved for missing ratings, and more generally, missing marks.10 For example, since all values in the above code chunk are negative infinities, this means this treatment-reader-case combination did not yield any mark-rating pairs. This possibility, alluded to above, is only possible with FROC data. All other paradigms (ROC, LROC and ROI) yield at least one rating per case. The length of the fourth dimension of the NL array is determined by that treatment-reader-case combination yielding the maximum number of NLs. Consider the following chunk: for (i in 1:5) for (j in 1:4) for (k in 1:200) if (all(dataset04$NL[i,j,k,] != -Inf)) cat(i, j, k, all(dataset04$NL[i,j,k,] != -Inf),&quot;\\n&quot;) #&gt; 5 4 192 TRUE This shows that the fourth dimension of the NL array has to be of length 7 because one, and only reader, specifically reader “4”, made 7 NL marks on a diseased case in treatment “5”! 4.2.5 Ratings on a non-diseased case Unlike non-diseased cases, diseased cases can have both NL and LL ratings. For treatment 1, reader 1, case 51 (the 1st diseased case) the NL ratings are: dataset04$NL[1,1,51,] #&gt; [1] -Inf -Inf -Inf -Inf -Inf -Inf -Inf dataset04$lesionNum[1] #&gt; [1] 1 dataset04$LL[1,1,1,] #&gt; [1] 4 -Inf -Inf mean(is.finite(dataset04$LL)) #&gt; [1] 0.3043333 . There are only two finite values because this case has two ROI-level-abnormal regions, and 2 plus 2 makes for the assumed 4-regions per case. The corresponding $lesionNum field is 1. mean(is.finite(dataset04$NL[,,1:50,])) #&gt; [1] 0.05942857 dataset04$NL[1,1,51,] #&gt; [1] -Inf -Inf -Inf -Inf -Inf -Inf -Inf dataset04$lesionNum[1] #&gt; [1] 1 dataset04$LL[1,1,1,] #&gt; [1] 4 -Inf -Inf mean(is.finite(dataset04$LL)) #&gt; [1] 0.3043333 mean(is.finite(dataset04$NL[,,1:50,])) #&gt; [1] 0.05942857 dataset04$NL[1,1,51,] #&gt; [1] -Inf -Inf -Inf -Inf -Inf -Inf -Inf dataset04$lesionNum[1] #&gt; [1] 1 dataset04$LL[1,1,1,] #&gt; [1] 4 -Inf -Inf mean(is.finite(dataset04$LL)) #&gt; [1] 0.3043333 The ratings of the 2 ROI-level-abnormal ROIs on this case are 4. The mean rating over all ROI-level-abnormal ROIs is 3.6785323. mean(is.finite(dataset04$NL[,,1:50,])) #&gt; [1] 0.05942857 dataset04$NL[1,1,51,] #&gt; [1] -Inf -Inf -Inf -Inf -Inf -Inf -Inf dataset04$lesionNum[1] #&gt; [1] 1 dataset04$LL[1,1,1,] #&gt; [1] 4 -Inf -Inf mean(is.finite(dataset04$LL)) #&gt; [1] 0.3043333 4.3 The FROC Excel data file An Excel file in JAFROC format containing simulated ROI data corresponding to dataset04, is included with the distribution. The first command (below) finds the location of the file and the second command reads it and saves it to a dataset object ds. fileName &lt;- system.file( &quot;extdata&quot;, &quot;includedFrocData.xlsx&quot;, package = &quot;RJafroc&quot;, mustWork = TRUE) ds &lt;- DfReadDataFile(fileName) ds$dataType #&gt; [1] &quot;FROC&quot; The DfReadDataFile function automatically recognizes that this is an ROI dataset. Its structure is similar to the JAFROC format Excel file, with some important differences, noted below. It contains three worksheets: The Truth worksheet - this indicates which cases are diseased and which are non-diseased and the number of ROI-level-abnormal region on each case. There are 50 normal cases (labeled 1-50) under column CaseID and 40 abnormal cases (labeled 51-90). The LesionID field for each normal case (e.g., CaseID = 1) is zero and there is one row per case. For abnormal cases, this field has a variable number of entries, ranging from 1 to 4. As an example, there are two rows for CaseID = 51 in the Excel file: one with LesionID = 2 and one with LesionID = 3. The Weights field is always zero (this field is not used in ROI analysis). The FP (or NL) worksheet - this lists the ratings of ROI-level-normal regions. For ReaderID = 1, ModalityID = 1 and CaseID = 1 there are 4 rows, corresponding to the 4 ROI-level-normal regions in this case. The corresponding ratings are . The pattern repeats for other treatments and readers, but the rating are, of course, different. Each CaseID is represented in the FP worksheet (a rare exception could occur if a case-level abnormal case has 4 abnormal regions). The TP (or LL) worksheet - this lists the ratings of ROI-level-abnormal regions. Because normal cases generate TPs, one does not find any entry with CaseID = 1-50 in the TP worksheet. The lowest CaseID in the TP worksheet is 51, which corresponds to the first abnormal case. There are two entries for this case, corresponding to the two ROI-level-abnormal regions present in this case. Recall that corresponding to this CaseID in the Truth worksheet there were two entries with LesionID = 2 and 3. These must match the LesionID’s listed for this case in the TP worksheet. Complementing these two entries, in the FP worksheet for CaseID = 51, there are 2 entries corresponding to the two ROI-level-normal regions in this case. One should be satisfied that for each abnormal case the sum of the number of entries in the TP and FP worksheets is always 4. References "],
["roidataformat.html", "Chapter 5 ROI data format 5.1 ROI paradigm", " Chapter 5 ROI data format 5.1 ROI paradigm One can think of the ROI paradigm as similar to the FROC paradigm, but with localization accuracy restricted to belonging to a region (one cannot distinguish multiple lesions within a region). The ROIs are defined prior to the study and made known to all observers participating in the study. Unlike the FROC paradigm, a rating is required for every ROI. "],
["references.html", "References", " References "]
]
