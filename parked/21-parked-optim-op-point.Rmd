

## Introduction {#optim-op-point-intro}
A CAD system yields FROC mark-rating data where the (continuous scale) ratings generated by the algorithm are available to the algorithm designer with the understanding that only marks with ratings exceeding a pre-selected threshold are to be displayed (or reported) to the radiologist. The problem addressed in this chapter is how to select the optimal reporting threshold.

TBA: literature review

It is assumed that *the optimal reporting threshold $\zeta_{\text{max}}$ is the value of $\zeta_1$ that maximizes the AUC of an appropriately selected operating characteristic*. This chapter examines the effect of changing the reporting threshold $\zeta_1$ on the AUC for (a) the receiver operating characteristic (ROC) and (b) the weighted alternative free-response receiver operating characteristic (wAFROC).

TBA Summarize the sections that follow.

## Dependence of ROC performance on threshold {#optim-op-point-dependence-threshold-roc}
In Section \@ref(binormal-model-partial-true) it was shown that true ROC-AUC performance of a partial-area observer ^[Recall that a *partial area observer* was defined as follows: for cases with z-samples equal to or exceeding $\zeta_1$ the observer reports ratings exactly equal to the observed z-samples but for the remaining cases the observer assigns a *fixed value rating that is smaller than $\zeta_1$*.] is smaller than that of a full-area observer who rates all cases.  Also, true performance of a partial-area observer as a function of FPF has a maximum at FPF = 1. In other words, using the ROC figure of merit, performance of the CAD algorithm is maximized by displaying *all* the marks. 



## Dependence of FROC performance on threshold {#optim-op-point-dependence-threshold-wafroc}
The situation is different if one uses the wAFROC figure of merit. Consider the three wAFROC plots shown in see Fig. \@ref(fig:optim-op-point-dependence-threshold-wafroc-plot). These correspond to $\mu = 2$, $\lambda = 5$, $\nu = 1$, one lesion per case, and values of $\zeta_1$, from left to right: $\zeta_1 = 2$, $\zeta_1 = 1$ and $\zeta_1 = -1$. The area under the wAFROC curve in the middle plot is actually greater than that for the plots on either side of it, a fact that be difficult to appreciate, but is brought out more clearly in the next plot.  

```{r, echo=FALSE}
mu <- 2
lambda <- 5
nu <- 1
L <- 1
zeta1 <- 2
lesDistr <- c(rep(0, L-1), 1)
ret1 <- PlotRsmOperatingCharacteristics(
  mu, lambda, nu, zeta1, 
  lesDistr = L, legendPosition  = "none",
  llfRange = c(0,1)
)
p1 <- ret1$wAFROCPlot
```


```{r, echo=FALSE}
zeta1 <- 1
ret1 <- PlotRsmOperatingCharacteristics(
  mu, lambda, nu, zeta1, 
  lesDistr = L, legendPosition  = "none",
  llfRange = c(0,1)
)
p2 <- ret1$wAFROCPlot
```



```{r, echo=FALSE}
zeta1 <- -1
ret1 <- PlotRsmOperatingCharacteristics(
  mu, lambda, nu, zeta1, 
  lesDistr = L, legendPosition  = "none",
  llfRange = c(0,1)
)
p3 <- ret1$wAFROCPlot
```



```{r optim-op-point-dependence-threshold-wafroc-plot, fig.cap="Left plot: wAFROC curve for $\\zeta_1 = 2$; Middle plot: wAFROC curve for $\\zeta_1 = 1$; Right plot: wAFROC curve for $\\zeta_1 = -1$. The middle curve has the highest area under the curve. This fact is made clearer in the next figure.", fig.show='hold', echo=FALSE}
grid.arrange(p1, p2, p3, ncol = 3)
```


The next plot, see Fig. \@ref(fig:optim-op-point-dependence-threshold-wafroc-plot2), in which three previous plots are superposed, shows the differences in areas more clearly. The green plot (solid green line plus the dashed green line), corresponding to $\zeta_1 = 2$, clearly has the least area. The "green-red" plot (i.e., the solid green line plus the solid red line plus the dashed red line), corresponding to $\zeta_1 = 1$, has the greatest area. The "green-red-blue" plot (i.e., the solid green line plus the solid red line plus the solid blue line plus the dashed blue line), corresponding to $\zeta_1 = -1$, has slightly smaller area than that of the "green-red" plot. There is a maximum in area under the wAFROC curve near $\zeta_1 = 1$. A more precise determination of the optimal value of $\zeta_1$, using numerical search, will be shown later, but it is clear a maximum exists and that it does not correspond to $\zeta_1 = -\infty$, in other words it does not correspond to showing all the marks, as was the case when one used the ROC operating characteristic. 

The essential difference between the ROC and the wAFROC examples is this: as one moves up the proper ROC curve: 
* The slope decreases monotonically; 
* At each point the slope is greater than that of the straight line connecting the point to (1,1) and 
* The curve ends at (1,1) 

In contrast, for the wAFROC curve: 
* The slope decreases monotonically
* At each point the slope is not greater than that of the straight line connecting the point to (1,1) and 
* The curve ends below-left to (1,1) 

The wAFROC resembles an improper ROC but this time it is not a fitting artifact. *The geometrical differences in the shapes of the two curves enables a finite and meaningful optimal $\zeta_1$ determination for the wAFROC but not for the ROC*.

In the following sections the optimal operating point determined using the wAFROC curve will be explored for two algorithmic observer, one with low performance and one with performance similar to an expert radiologist. Since CAD developers are more familiar with FROC curves than wAFROC curves, the optimal operating points for the two algorithms will be illustrated using FROC curves. 



```{r, echo=FALSE}
df1 <- data.frame(FPF = p1$data$FPF, wLLF = p1$data$wLLF)

endPoint1 <- data.frame(FPF = p1$data$FPF[1], wLLF = p1$data$wLLF[1])
section2 <- which(p2$data$FPF >= endPoint1$FPF)
df2 <- data.frame(FPF = p2$data$FPF[section2], 
                  wLLF = p2$data$wLLF[section2])

endPoint2 <- data.frame(FPF = p2$data$FPF[1], wLLF = p2$data$wLLF[1])
section3 <- which(p3$data$FPF >= endPoint2$FPF)
df3 <- data.frame(FPF = p3$data$FPF[section3], 
                  wLLF = p3$data$wLLF[section3])

endPoint3 <- data.frame(FPF = p3$data$FPF[1], wLLF = p3$data$wLLF[1])
dashed1 <- data.frame(FPF = c(p1$data$FPF[1], 1), wLLF = c(p1$data$wLLF[1], 1))
dashed2 <- data.frame(FPF = c(p2$data$FPF[1], 1), wLLF = c(p2$data$wLLF[1], 1))
dashed3 <- data.frame(FPF = c(p3$data$FPF[1], 1), wLLF = c(p3$data$wLLF[1], 1))
p <- ggplot2::ggplot(data = df1, aes(x = FPF, y = wLLF)) + 
  geom_line(color = "green3") + 
  geom_point(data = endPoint1, size = 3, color = "green3") + 
  geom_line(data = dashed1, aes(x = FPF, y = wLLF), linetype = 3, color = "green3") + 
  geom_line(data = df2, color = "red") + 
  geom_point(data = endPoint2, size = 3, color = "red") + 
  geom_line(data = dashed2, aes(x = FPF, y = wLLF), linetype = 3, color = "red") + 
  geom_line(data = df3, color = "blue") + 
  geom_point(data = endPoint3, size = 3, color = "blue") + 
  geom_line(data = dashed3, aes(x = FPF, y = wLLF), linetype = 3, color = "blue") + 
  scale_x_continuous(limits = c(0,1)) + scale_y_continuous(limits = c(0,1))
```


```{r optim-op-point-dependence-threshold-wafroc-plot2, fig.cap="The green curve corresponds to $\\zeta_1 = 2$, the green+red curve corresponds to $\\zeta_1 = 1$ and the green+red+blue curve corresponds to $\\zeta_1 = -1$. The green+red curve plus the red dashed line extension has the greatest area under the wAFROC, corresponding to being near the optimal choice of threshold. Note that each area includes that under the corresponding dashed line.", fig.show='hold', echo=FALSE}
grid.arrange(p)
```
