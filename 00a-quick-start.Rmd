# (PART\*) Quick Start {-}

# DBM analysis text output {#quick-start-dbm-text}


```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(RJafroc)
```

## Introduction {#quick-start-dbm-text-intro}
This chapter is intended for those seeking a quick-and-easy transition from Windows `JAFROC` to `RJafroc`. Described first is the structure of an `RJafroc` dataset followed by how to read a JAFROC  format Excel file to create an `RJafroc` dataset.

## Reading a JAFROC format file {#quick-start-dbm-text-read-file}

There is a file `RocData.xlsx` contained in directory `R/quick-start`. This is identical to embedded `dataset02`, the Van Dyke dataset in the ROC literature [@RN1993]. Here are screen shots of the three worksheets comprising this Excel file. 



```{r quick-start-dbm-roc-xlsx, echo=FALSE,out.width="50%",out.height="20%",fig.cap="Three worksheets - Truth, FP and TP, comprising Excel file `R/quick-start/Roc.xlsx`",fig.show='hold',fig.align='center'}
knitr::include_graphics(c("R/quick-start/RocTruth.png", "R/quick-start/RocFP.png", "R/quick-start/RocTP.png"))
``` 


Next, one uses `DfReadDataFile()` as follows, to read the data file into an `R` object.


```{r quick-start-dbm-text-read-data-file}
fileName <- "R/quick-start/Roc.xlsx"
ds2 <- DfReadDataFile(fileName)
str(ds2)
``` 


The following illustration uses a different dataset.


## Dataset structure {#quick-start-dbm-text-dataset-structure}
Data set `dataset03` corresponding to the Franken ROC dataset [@RN1995] is embedded in `RJafroc`. The structure of this dataset is shown below.

```{r dataset-str, echo=TRUE}
ds <- dataset03
str(ds)
```             

* `ds` is a list with 3 members. 
    + `ratings`
    + `lesions`
    + `descriptions`
* `ratings` is a list with three members
    + `NL` This contains the NL/FP ratings
    + `LL` This contains the LL/TP ratings
    + `LL_IL` This contains the LROC incorrect localization ratings
* `lesions` is a list with 3 members
    + `perCase` number of lesions per diseased case array
    + `IDs` lesion IDs array (labels attached to each lesion)
    + `weights` lesion weights array
* `descriptions` is a list with 7 members
    + `fileName` name of the original file the data came from, if available, or the embedded dataset name
    + `type` The type of dataset, "ROC", "FROC", "LROC" or "ROI"
    + `name` The name of the dataset
    + `truthTableStr` The structure of the truth table, for internal use, for checking data consistency
    + `design` The design of the dataset, FCTRL, SPLIT-PLOT-A or SPLIT-PLOT-C
    + `modalityID` The IDs of the modalities
    + `readerID` The IDs of the readers


The false positive ratings are contained in `NL`, an array with dimensions `[1:2,1:4,1:100,1]`. 

```{r dataset-str-nl, echo=TRUE}
str(ds$ratings$NL)
```             

The first index corresponds to the two treatments. The second index corresponds to the four readers. The third index corresponds to the 100 cases. The fourth dimension, with length one, corresponds to one FP/NL per case; the redundant index is needed for consistency with FROC data, where multiple NLs per case are possible.

```{r dataset-str-nl34-100, echo=TRUE}
str(ds$ratings$NL[1,1,34:100,1])
all(ds$ratings$ratings$ratings$NL[,,34:100,1] == -Inf)
```             


The entries in this array for cases 34 through 100 are all `-Inf` (this is tested for by the `all()` function, which yields `TRUE` if all of its arguments are true). In the ROC paradigm false positive are not possible on diseased cases (but they are possible for FROC data). So the actual FP ratings are contained in the first 33 elements of the array. 


```{r dataset-str-ll, echo=TRUE}
str(ds$ratings$LL)
```             

`LL` is an array with dimensions `[1:2,1:4,1:67,1]`. This implies 67 diseased cases and by subtraction from 100 there must be 33 non-diseased cases. The redundant dimension, with length one, is needed for consistency with FROC data, where multiple lesions per case are possible.

```{r dataset-str-perCase, echo=TRUE}
str(ds$lesions$perCase)
```             


`perCase` is a vector with length 67, implying 100 - 67 = 33 non-diseased cases. Each element of `perCase` is unity, corresponding to one lesion per diseased case for ROC data.


```{r dataset-str-ids-weights, echo=TRUE}
str(ds$lesions$IDs)
str(ds$lesions$weights)
```             


The list members `lesionID` and `lesionWeight` are arrays with dimensions `[1:67,1]` containing ones. Again, these imply 67 diseased cases. The extra dimension, with length one, is needed for consistency with FROC data. The variables `perCase`, `IDs` and `weights`, while not needed for ROC data, are there for consistency with FROC data.

```{r dataset-str-type, echo=TRUE}
str(ds$descriptions$type)
```             


The `type` list member is the character string `"ROC"`, for an ROC dataset. Other possibilities are `"FROC"`, `"LROC"` and `"ROI"`.

    
```{r dataset-str-modality-id, echo=TRUE}
str(ds$descriptions$modalityID)
```             


The `modalityID` list member is a character string with two entries, `"TREAT1"` and `"TREAT2"`, corresponding to the two modalities. 

    
```{r dataset-str-reader-id, echo=TRUE}
str(ds$descriptions$readerID)
```             

The `readerID` list member is a character string with four entries, `"READER_1"`,  `"READER_2"`, `"READER_3"` and `"READER_4"` corresponding to the four readers. 
    

Here are the actual ratings for cases 1 through 33.

```{r list-nl-ratings-1-1}
ds$ratings$NL[1,1,1:33,1]
``` 

This says that for treatment 1 and reader 1, (non-diseased) case 1 was rated 3, case 2 was rated 1, cases 3-7 were rated 2, case 8 was rated 4, etc. As another example, for treatment 2 and reader 3, the FP ratings are: 

```{r list-nl-ratings-2-3}
ds$ratings$NL[2,3,1:33,1]
``` 


This says that for treatment 2 and reader 3, (non-diseased) case 1 was rated 3, case 2 was rated 1, cases 3-6 were rated 2, cases 7-8 were rated 4, etc. 


## Analyzing the ROC dataset {#quick-start-dbm-text-analyze-dataset}

This illustrates the `StSignificanceTesting()` function. The significance testing method is specified as `"DBM"` and the figure of merit `FOM` is specified as "Wilcoxon".

```{r quick-start-dbm-text-significance-testing}
ret <- StSignificanceTesting(ds, FOM = "Wilcoxon", method = "DBM")
```             

## Explanation of the output {#quick-start-dbm-text-explanation}
The function returns a list with 5 members: 

* `FOMs`: figures of merit.
* `ANOVA`: ANOVA tables.
* `RRRC`: random-reader random-case analyses results.
* `FRRC`: fixed-reader random-case analyses results.
* `RRFC`" random-reader fixed-case analyses results.

Let us consider them one by one. 

* `FOMs` is a list of 3
    + `foms` is a [2x4] dataframe: the figure of merit for each of of the four observers in the two treatments.
    + `trtMeans` is a [2x1] dataframe: the average figure of merit over all readers for each treatment.
    + `trtMeanDiffs` a [1x1] dataframe: the difference(s) of the reader-averaged figures of merit for all different treatment pairings. In this example, with only two treatments, there is only one different treatment pairing.
    
```{r}
ret$FOMs$foms
ret$FOMs$trtMeans
ret$FOMs$trtMeanDiffs
```             

* ANOVA is a list of 4
    + `TRCanova` is a [8x3] dataframe: the treatment-reader-case ANOVA table, see below, where SS is the sum of squares, DF is the degrees of freedom and MS is the mean squares, and T = treatment, R = reader, C = case, TR = treatment-reader, TC = treatment-case, RC = reader-case, TRC = treatment-reader-case.  
    + `VarCom` is a [6x1] dataframe: the variance components, see below, where `varR` is the reader variance, `varC` is the case variance, `varTR` is the treatment-reader variance, `varTC` is the treatment-case variance, `varRC` is the reader-case variance, and `varTRC` is the treatment-reader-case variance.
    + `IndividualTrt` is a [3x3] dataframe: the individual treatment variance components averaged over all readers, see below, where `msR` is the mean square reader, `msC` is the mean square case and `msRC` is the mean square reader-case.
    + `IndividualRdr` is a [3x5] dataframe: the individual reader variance components averaged over treatments, see below, where `msT` is the mean square treatment, `msC` is the mean square case and `msTC` is the mean square treatment-case.
    
```{r}
ret$ANOVA$TRCanova
ret$ANOVA$VarCom
ret$ANOVA$IndividualTrt
ret$ANOVA$IndividualRdr
```             

* RRRC, a list of 3 containing results of random-reader random-case analyses
    + `FTtests`: is a [2x4] dataframe: results of the F-tests, see below, where `FStat` is the F-statistic and `p` is the p-value.
    + `ciDiffTrt`: is a [1x7] dataframe: the confidence intervals between different treatments, see below, where `StdErr` is the standard error of the estimate, `t` is the t-statistic and `PrGTt` is the p-value.
    + `ciAvgRdrEachTrt`: is a [2x5] dataframe: the confidence intervals for the average reader over each treatment, see below, where `CILower` is the lower 95% confidence interval and `CIUpper` is the upper 95% confidence interval.
    
```{r}
ret$RRRC$FTests
ret$RRRC$ciDiffTrt
ret$RRRC$ciAvgRdrEachTrt
```             

* FRRC, a list of 4 containing results of fixed-reader random-case analyses
    + `FTtests`: is a [2x4] dataframe: results of the F-tests, see below.
    + `ciDiffTrt`: is a [1x7] dataframe: the confidence intervals between different treatments, see below.
    + `ciAvgRdrEachTrt`: is a [2x5] dataframe: the confidence intervals for the average reader over each treatment
    + `ciDiffTrtEachRdr`: is a [4x7] dataframe: the confidence intervals for each different-treatment pairing for each reader. 
    
```{r}
ret$FRRC$FTests
ret$FRRC$ciDiffTrt
ret$FRRC$ciAvgRdrEachTrt
ret$FRRC$ciDiffTrtEachRdr
```             

    
* RRFC, a list of 3 containing results of random-reader fixed-case analyses
    + `FTtests`: is a [2x4] dataframe: results of the F-tests, see below. 
    + `ciDiffTrt`: is a [1x7] dataframe: the confidence intervals between different treatments, see below. 
    + `ciAvgRdrEachTrt`: is a [2x5] dataframe: the confidence intervals for the average reader over each  over each treatment.  

    
```{r}
ret$RRFC$FTests
ret$RRFC$ciDiffTrt
ret$RRFC$ciAvgRdrEachTrt
```             


## References {#quick-start-dbm-text-references}
